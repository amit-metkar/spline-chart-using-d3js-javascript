var chartData = {};
chartData.valueTransformation = 'rawValue';
chartData.data = [[21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 23378.0, 20735.0, 18578.0, 16826.0, 17085.0, 17562.0, 18133.0, 18765.0, 19418.0, 20092.0, 20776.0, 21460.0, 22155.0, 22881.0, 23638.0, 24405.0, 25213.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 25006.0, 24882.0, 25151.0, 25421.0, 25711.0, 25991.0, 26219.0, 26447.0, 26675.0, 26903.0, 27131.0, 27359.0, 27577.0, 27805.0, 28033.0, 28261.0, 28479.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 21253.0, 17365.0, 14068.0, 11332.0, 10388.0, 10585.0, 10855.0, 11155.0, 11497.0, 11850.0, 12223.0, 12607.0, 13052.0, 13509.0, 13965.0, 14431.0, 14919.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 25483.0, 26001.0, 26489.0, 26924.0, 27318.0, 27639.0, 27940.0, 28251.0, 28521.0, 28780.0, 29049.0, 29309.0, 29578.0, 29848.0, 30117.0, 30376.0, 30646.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 18.0, 18.2, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 18.0, 18.2, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 18.0, 18.2, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18.0, 18.0, 18.0, 18.0, 18.0], [28.1, 25.8, 18.1, 22.5, 13.1, 16.0, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0, 18.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 23378.0, 20735.0, 18578.0, 16826.0, 17085.0, 17562.0, 18133.0, 18765.0, 19418.0, 20092.0, 20776.0, 21460.0, 22155.0, 22881.0, 23638.0, 24405.0, 25213.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 25006.0, 24882.0, 25151.0, 25421.0, 25711.0, 25991.0, 26219.0, 26447.0, 26675.0, 26903.0, 27131.0, 27359.0, 27577.0, 27805.0, 28033.0, 28261.0, 28479.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 21253.0, 17365.0, 14068.0, 11332.0, 10388.0, 10585.0, 10855.0, 11155.0, 11497.0, 11850.0, 12223.0, 12607.0, 13052.0, 13509.0, 13965.0, 14431.0, 14919.0], [21179.0, 21621.0, 22469.0, 23277.0, 24508.0, 25125.0, 25483.0, 26001.0, 26489.0, 26924.0, 27318.0, 27639.0, 27940.0, 28251.0, 28521.0, 28780.0, 29049.0, 29309.0, 29578.0, 29848.0, 30117.0, 30376.0, 30646.0], ["null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null"], ["null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null"], ["null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null"], ["null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null", "null"]];
chartData.periods = ["2016/03/31", "2016/06/30", "2016/09/30", "2016/12/31", "2017/03/31", "2017/06/30", "2017/09/30", "2017/12/31", "2018/03/31", "2018/06/30", "2018/09/30", "2018/12/31", "2019/03/31", "2019/06/30", "2019/09/30", "2019/12/31", "2020/03/31", "2020/06/30", "2020/09/30", "2020/12/31", "2021/03/31", "2021/06/30", "2021/09/30"];
chartData.index = [["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC ADS"], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC CC"], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC SS ADS"], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC QQ"], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC ADS"], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC CC"], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS"], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC QQ"], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC ADS"], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC CC"], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS"], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC QQ"], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC ADS"], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC CC"], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS"], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC QQ"], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC ADS"], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC CC"], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC SS ADS"], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC QQ"], ["G5", "Total Equity XYZs volumes", "ABC ADS"], ["G5", "Total Equity XYZs volumes", "ABC CC"], ["G5", "Total Equity XYZs volumes", "ABC SS ADS"], ["G5", "Total Equity XYZs volumes", "ABC QQ"]];
chartData.indexHeaders = ["Variable ID", "Variable Name", "Scenario"];
chartData.colors = ['#6490cb', '#5fa364', '#d6bc38', '#9579a1', '#d58b46', '#5ba5a3', '#ab8341', '#969696',
    '#92adce', '#93c196', '#e7d88b', '#b09bb9', '#e9aa75', '#80c4c4', '#d7cdaf', '#c0c0c0',
    '#d6e0ec', '#c9e7b7', '#f2edbe', '#d0d0e8'];
chartData.plotData = [];

sheetData = { "meta_data": { "forecasted_requested": [], "fixed_rows": 5, "requested_variables": ["G5"], "launchpoint_column": 5, "frequency": "quarterly", "launchpoint_date": "2017/06/30", "historical_requested": ["G5"], "exercise_label": "Title", "fixed_cols": 3 } };

function prepareData() {
    chartData.plotData = [];

    var ht_data = [["", "Title - SubTitle", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], ["", "DRAFT - PRELIMINARY & UNAPPROVED - NOT FOR DISTRIBUTION", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], ["", "", "", "", "", "Launchpoint", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null], ["", "", "Periods", "2016/03/31", "2016/06/30", "2016/09/30", "2016/12/31", "2017/03/31", "2017/06/30", "2017/09/30", "2017/12/31", "2018/03/31", "2018/06/30", "2018/09/30", "2018/12/31", "2019/03/31", "2019/06/30", "2019/09/30", "2019/12/31", "2020/03/31", "2020/06/30", "2020/09/30", "2020/12/31", "2021/03/31", "2021/06/30", "2021/09/30"], ["ID", "Variable Name", "Scenario", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC ADS", 21179, 21621, 22469, 23277, 24508, 25125, 23378, 20735, 18578, 16826, 17085, 17562, 18133, 18765, 19418, 20092, 20776, 21460, 22155, 22881, 23638, 24405, 25213], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC CC", 21179, 21621, 22469, 23277, 24508, 25125, 25006, 24882, 25151, 25421, 25711, 25991, 26219, 26447, 26675, 26903, 27131, 27359, 27577, 27805, 28033, 28261, 28479], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC SS ADS", 21179, 21621, 22469, 23277, 24508, 25125, 21253, 17365, 14068, 11332, 10388, 10585, 10855, 11155, 11497, 11850, 12223, 12607, 13052, 13509, 13965, 14431, 14919], ["A10", "Wow Dude Total Stock XYZ Index (EOP)", "ABC QQ", 21179, 21621, 22469, 23277, 24508, 25125, 25483, 26001, 26489, 26924, 27318, 27639, 27940, 28251, 28521, 28780, 29049, 29309, 29578, 29848, 30117, 30376, 30646], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18, 18, 18, 18, 18, 18, 18, 18], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC CC", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 18, 18.2, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18, 18, 18, 18, 18], ["A18", "XYZ Volatility Index (VIX) - peak", "ABC QQ", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18, 18, 18, 18, 18, 18, 18, 18], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC CC", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 18, 18.2, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18, 18, 18, 18, 18], ["A19", "XYZ Volatility Index (VIX) - peak", "ABC QQ", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 24.2, 40.2, 36.1, 32.2, 28.7, 25.5, 22.7, 20.3, 18.1, 18, 18, 18, 18, 18, 18, 18, 18], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC CC", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 18, 18.2, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC SS ADS", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 31.6, 53.7, 77.6, 60.2, 52.4, 45.6, 39.7, 34.6, 30.1, 26.2, 22.8, 19.9, 18, 18, 18, 18, 18], ["A20", "XYZ Volatility Index (VIX) - peak", "ABC QQ", 28.1, 25.8, 18.1, 22.5, 13.1, 16, 15.4, 15.4, 15.4, 15.4, 15.8, 17.2, 17.2, 16.8, 18, 18, 18, 18, 18, 18, 18, 18, 18], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC ADS", 21179, 21621, 22469, 23277, 24508, 25125, 23378, 20735, 18578, 16826, 17085, 17562, 18133, 18765, 19418, 20092, 20776, 21460, 22155, 22881, 23638, 24405, 25213], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC CC", 21179, 21621, 22469, 23277, 24508, 25125, 25006, 24882, 25151, 25421, 25711, 25991, 26219, 26447, 26675, 26903, 27131, 27359, 27577, 27805, 28033, 28261, 28479], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC SS ADS", 21179, 21621, 22469, 23277, 24508, 25125, 21253, 17365, 14068, 11332, 10388, 10585, 10855, 11155, 11497, 11850, 12223, 12607, 13052, 13509, 13965, 14431, 14919], ["A9", "Wow Dude Total Stock XYZ Index (EOP)", "ABC QQ", 21179, 21621, 22469, 23277, 24508, 25125, 25483, 26001, 26489, 26924, 27318, 27639, 27940, 28251, 28521, 28780, 29049, 29309, 29578, 29848, 30117, 30376, 30646], ["G5", "Total Equity XYZs volumes", "ABC ADS", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], ["G5", "Total Equity XYZs volumes", "ABC CC", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], ["G5", "Total Equity XYZs volumes", "ABC SS ADS", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], ["G5", "Total Equity XYZs volumes", "ABC QQ", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]];

    if (ht_data) {
        var modifiedData = [];
        for (var i = 5; i < ht_data.length; i++) {
            var newRow = [];
            modifiedData.push(newRow);
            //for (var j = sheetData['meta_data']['launchpoint_column']; j < ht_data[i].length; j++) {
            for (var j = 3; j < ht_data[i].length; j++) {
                newRow.push(ht_data[i][j]);
            }
        }
    }
    var valTransform = chartData.valueTransformation;
    console.log(valTransform);
    if (valTransform !== 'rawValue') {
        // Transform data to either raw change or percent change
        var transformedData = [];
        for (var i = 0; i < modifiedData.length; i++) {
            // Iterate over all rows
            var launchpoint_value = modifiedData[i][sheetData.meta_data.launchpoint_column];
            var newRow = [];
            transformedData.push(newRow);
            for (var j = 0; j < modifiedData[i].length; j++) {
                var val = null;
                if (valTransform === 'rawChangeAbsolute') {
                    val = modifiedData[i][j] - launchpoint_value;
                } else if (valTransform === 'rawChangeRelative') {
                    if (j === 0) {
                        val = 0;
                    } else {
                        val = modifiedData[i][j] - modifiedData[i][j - 1];
                    }
                } else if (valTransform === 'percentChangeAbsolute') {
                    val = 100 * (modifiedData[i][j] - launchpoint_value) / launchpoint_value;
                } else if (valTransform === 'percentChangeRelative') {
                    if (j === 0) {
                        val = 0;
                    } else {
                        val = 100 * (modifiedData[i][j] - modifiedData[i][j - 1]) / modifiedData[i][j - 1];
                    }
                }
                newRow.push(val);
            }
        }
        chartData.data = transformedData;
    } else {
        chartData.data = modifiedData;
    }

    for (var i = 0; i < chartData.data.length; i++) {
        var rowData = [];
        for (var j = 0; j < chartData.periods.length; j++) {
            var y = chartData.data[i][j];
            if (y != +y) {
                y = null;
            }
            var d = new Date(chartData.periods[j]);
            var x = Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
            // var x = (new Date(chartData.periods[j])).getTime();
            rowData.push([x, y]);
        }
        if (rowData.length > 0) {
            var label = '[' + chartData.index[i][0] + '] ' + chartData.index[i][1] + ' / ' + chartData.index[i][2];
            chartData.plotData.push({
                var_id: chartData.index[i][0],
                data: rowData,
                var_name: '[' + chartData.index[i][0] + '] ' + chartData.index[i][1],
                scenario: chartData.index[i][2],
                label2: label,
                name: label,
                color: chartData.colors[i % 20]
            });
        }
    }
    console.log(chartData.plotData);
}

prepareData();

function changeData(e) {
    chartData.valueTransformation = e;
    prepareData()
    $("#chart-container").splineChart().data('data', {});
}

$("#chart-container").splineChart({
    title: "Title",
    id: "chart",
    w: 600,
    h: 350,
    data: chartData,
    axisName: {
        y: 'YValues'
    },
    onTransformData: function (d, i) {
        console.log(d, i);
        if (chartData.valueTransformation != d.key) {
            chartData.valueTransformation = d.key;
            prepareData();
            $("#chart-container").splineChart({
                data: chartData
            });
        }
    }
});
$("#chart-container-1").splineChart({ title: "Title", id: "chart", w: 600, h: 350, data: chartData, axisName: { y: 'YValues' } });
// $("#chart-container-2").splineChart({ title: "Title", id: "chart", w: 600, h: 350, data: chartData, axisName: { y: 'YValues' } });
// $("#chart-container-3").splineChart({ title: "Title", id: "chart", w: 600, h: 350, data: chartData, axisName: { y: 'YValues' } });